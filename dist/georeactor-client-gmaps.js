/*
 GeoReactor-Client 0.1.1+18b5cfc  http://georeactor.com
 (c) 2016 Nicholas Doiron (under open source, MIT license)
*/
!function(e,o,t){"undefined"==typeof console&&(console={log:function(){},error:function(){}}),Array.prototype.forEach||(Array.prototype.forEach=function(e,o){var t,n;for(t=0,n=this.length;t<n;++t)t in this&&e.call(o,this[t],t,this)}),"map"in Array.prototype||(Array.prototype.map=function(e,o){for(var t=new Array(this.length),n=0,a=this.length;n<a;n++)n in this&&(t[n]=e.call(o,this[n],n,this));return t}),(e||global).georeactor=function(){console.error("GEOREACTOR: no maps library was added")},(e||global).GEOREACTOR={data:[],options:{},valuesForField:{},_:{}},function(){function e(e,n){var a=e,r=new XMLHttpRequest;r.open("GET",e,!0),r.onreadystatechange=function(){if(4===this.readyState)if(this.status>=200&&this.status<400){var e=null,r=a.toLowerCase();if(r.indexOf("topojson")>-1||r.indexOf("topo.json")>-1){var i=JSON.parse(this.responseText),s=Object.keys(i.objects)[0];e=topojson.feature(i,i.objects[s])}else{if(!(r.indexOf("geojson")>-1||r.indexOf("geo.json")>-1))throw"data type unknown: "+r;e=JSON.parse(this.responseText)}e.features.map(function(e){var n=Object.keys(e.properties);n.map(function(o){var t=e.properties[o];GEOREACTOR.valuesForField[o]||(GEOREACTOR.valuesForField[o]={min:t,max:t,nonZeroCount:0}),t<GEOREACTOR.valuesForField[o].min&&(GEOREACTOR.valuesForField[o].min=t),t>GEOREACTOR.valuesForField[o].max&&(GEOREACTOR.valuesForField[o].max=t),t&&GEOREACTOR.valuesForField[o].nonZeroCount++});var a=o(e.geometry.coordinates);e.properties.bounds=a,t?(t[0]=Math.min(t[0],a[0]),t[1]=Math.min(t[1],a[1]),t[2]=Math.max(t[2],a[2]),t[3]=Math.max(t[3],a[3])):t=a}),GEOREACTOR._.fitBounds(t),n(e)}else console.log("failed to do XMLHttpRequest")},r.send()}function o(e,t){if(t||(t=[180,90,-180,-90]),"number"==typeof e[0])t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.max(t[2],e[0]),t[3]=Math.max(t[3],e[1]);else for(var n=0;n<e.length;n++)t=o(e[n],t);return t}var t;GEOREACTOR.commonDataLoader=function(){0===GEOREACTOR.options.data.length&&console.log("GEOREACTOR: no datasets to load"),GEOREACTOR.options.data.map(function(o){e(o,function(e){GEOREACTOR._.mapJSONfile(e)})})}}(),function(){var t;return"undefined"==typeof GEOREACTOR?void console.error("GEOREACTOR: georeactor-gmaps.js must be loaded for georeactor-gmaps to work"):(GEOREACTOR.library="gmaps",GEOREACTOR._.mapJSONfile=function(e){return t.data.addGeoJson(e),t.data.setStyle(function(e){return{fillColor:"#f00",fillOpacity:0,strokeColor:"#444",strokeWeight:1}}),t.data.addListener("click",function(e){GEOREACTOR._.fitBounds(e.feature.getProperty("bounds")),GEOREACTOR.selectFeature=e.feature,GEOREACTOR._.detailView&&GEOREACTOR._.detailView.setState({selectFeature:e.feature}),t.data.setStyle(function(o){var t=0;return o===e.feature&&(t=.2),{fillColor:"#f00",fillOpacity:t,strokeColor:"#444",strokeWeight:1}})}),t.data},GEOREACTOR.initMap=function(){t=new google.maps.Map(o.getElementById(GEOREACTOR.options.div||"map"),{zoom:5,center:{lat:0,lng:0},streetViewControl:!1}),GEOREACTOR._.fitBounds=function(e){t.fitBounds(new google.maps.LatLngBounds(new google.maps.LatLng(e[1],e[0]),new google.maps.LatLng(e[3],e[2])))},GEOREACTOR.commonDataLoader(),"function"==typeof GEOREACTOR.initReact&&GEOREACTOR.initReact()},void(georeactor=function(t){"localhost"===e.location.hostname&&(t.API_KEY=""),GEOREACTOR.options=t;var n=o.createElement("script");n.src="//maps.googleapis.com/maps/api/js?callback=GEOREACTOR.initMap&key="+(t.API_KEY||""),o.body.appendChild(n)}))}()}(window,document);