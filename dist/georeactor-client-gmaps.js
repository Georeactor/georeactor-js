/*
 GeoReactor-Client 0.1.1+470b123  http://georeactor.com
 (c) 2016 Nicholas Doiron (under open source, MIT license)
*/
!function(t,e,o){"undefined"==typeof console&&(console={log:function(){},error:function(){}}),Array.prototype.forEach||(Array.prototype.forEach=function(t,e){var o,n;for(o=0,n=this.length;o<n;++o)o in this&&t.call(e,this[o],o,this)}),"map"in Array.prototype||(Array.prototype.map=function(t,e){for(var o=new Array(this.length),n=0,a=this.length;n<a;n++)n in this&&(o[n]=t.call(e,this[n],n,this));return o}),(t||global).georeactor=function(){console.error("GEOREACTOR: no maps library was added")},(t||global).GEOREACTOR={data:[],options:{},valuesForField:{},_:{}},function(){function t(t,n){var a=t,r=new XMLHttpRequest;r.open("GET",t,!0),r.onreadystatechange=function(){if(4===this.readyState)if(this.status>=200&&this.status<400){var t=null,r=a.toLowerCase();if(r.indexOf("topojson")>-1||r.indexOf("topo.json")>-1){var i=JSON.parse(this.responseText),s=Object.keys(i.objects)[0];t=topojson.feature(i,i.objects[s])}else{if(!(r.indexOf("geojson")>-1||r.indexOf("geo.json")>-1))throw"data type unknown: "+r;t=JSON.parse(this.responseText)}t.features.map(function(t){var n=Object.keys(t.properties);n.map(function(e){var o=t.properties[e];GEOREACTOR.valuesForField[e]||(GEOREACTOR.valuesForField[e]={min:o,max:o,nonZeroCount:0}),o<GEOREACTOR.valuesForField[e].min&&(GEOREACTOR.valuesForField[e].min=o),o>GEOREACTOR.valuesForField[e].max&&(GEOREACTOR.valuesForField[e].max=o),o&&GEOREACTOR.valuesForField[e].nonZeroCount++});var a=e(t.geometry.coordinates);t.properties.bounds=a,o?(o[0]=Math.min(o[0],a[0]),o[1]=Math.min(o[1],a[1]),o[2]=Math.max(o[2],a[2]),o[3]=Math.max(o[3],a[3])):o=a}),GEOREACTOR._.fitBounds(o),n(t)}else console.log("failed to do XMLHttpRequest")},r.send()}function e(t,o){if(o||(o=[180,90,-180,-90]),"number"==typeof t[0])o[0]=Math.min(o[0],t[0]),o[1]=Math.min(o[1],t[1]),o[2]=Math.max(o[2],t[0]),o[3]=Math.max(o[3],t[1]);else for(var n=0;n<t.length;n++)o=e(t[n],o);return o}var o;GEOREACTOR.parseAttribute=function(t,e){var o=t+"",n=(e||"")+"",a=function(t){return t.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")};if(GEOREACTOR.options&&GEOREACTOR.options.attributes){var r=GEOREACTOR.options.attributes[o];if(r===!1)return!1;if("undefined"!=typeof r&&null!==r)if("function"==typeof r.label?o=r.label(t,e,GEOREACTOR.selectFeature):"string"==typeof r.label&&(o=r.label),"function"==typeof r.value)n=r.value(t,e,GEOREACTOR.selectFeature);else if("string"==typeof r.value){var i=new RegExp("#\\{"+a(t)+"\\}","g");n=r.value.replace(i,n)}}return"object"==typeof n&&(n=JSON.stringify(n)),[o,n]},GEOREACTOR.sortPropKeys=function(t){return GEOREACTOR.options.attributes&&GEOREACTOR.options.attributes._order&&t.sort(function(t,e){var o=GEOREACTOR.options.attributes._order.indexOf(t.label),n=GEOREACTOR.options.attributes._order.indexOf(e.label);if(o!==n){if(o===-1)return 1;if(n===-1)return-1}return o-n}),t},GEOREACTOR.commonDataLoader=function(){0===GEOREACTOR.options.data.length&&console.log("GEOREACTOR: no datasets to load"),GEOREACTOR.options.data.map(function(e){t(e,function(t){GEOREACTOR._.mapJSONfile(t)})})}}(),function(){var o,n;return"undefined"==typeof GEOREACTOR?void console.error("GEOREACTOR: georeactor-gmaps.js must be loaded for georeactor-gmaps to work"):(GEOREACTOR.library="gmaps",GEOREACTOR._.mapJSONfile=function(t){return o.data.addGeoJson(t),o.data.setStyle(function(t){return{fillColor:"#f00",fillOpacity:0,strokeColor:"#444",strokeWeight:1}}),o.data.addListener("click",function(t){if(GEOREACTOR._.fitBounds(t.feature.getProperty("bounds")),GEOREACTOR.selectFeature=t.feature,GEOREACTOR._.detailView&&GEOREACTOR._.detailView.setState({selectFeature:t.feature}),GEOREACTOR.options.popups){var e=["bounds"],a="<table>",r=[],i={};t.feature.forEachProperty(function(t,e){r.push(e),i[e]=t}),r=GEOREACTOR.sortPropKeys(r),r.map(function(t){if(!(e.indexOf(t)>-1)){var o=GEOREACTOR.parseAttribute(t,i[t]);o!==!1&&(a+="<tr><td>"+o[0]+"</td><td>"+o[1]+"</td></tr>")}}),a+="</table>",n.setPosition(t.latLng),n.setContent(a),n.open(o)}o.data.setStyle(function(e){var o=0;return e===t.feature&&(o=.2),{fillColor:"#f00",fillOpacity:o,strokeColor:"#444",strokeWeight:1}})}),o.data},GEOREACTOR.initMap=function(){o=new google.maps.Map(e.getElementById(GEOREACTOR.options.div||"map"),{zoom:GEOREACTOR.options.zoom||5,center:{lat:GEOREACTOR.options.lat||0,lng:GEOREACTOR.options.lng||GEOREACTOR.options.lon||0},streetViewControl:!1}),n=new google.maps.InfoWindow({map:o}),n.close(),GEOREACTOR._.fitBounds=function(t){o.fitBounds(new google.maps.LatLngBounds(new google.maps.LatLng(t[1],t[0]),new google.maps.LatLng(t[3],t[2])))},GEOREACTOR.commonDataLoader(),"function"==typeof GEOREACTOR.initReact&&GEOREACTOR.initReact()},void(georeactor=function(o){"localhost"===t.location.hostname&&(o.API_KEY=""),GEOREACTOR.options=o;var n=e.createElement("script");n.src="//maps.googleapis.com/maps/api/js?callback=GEOREACTOR.initMap&key=AIzaSyDfcomdn4y5hE1UblikOcMjtzY_ilhSP-4",e.body.appendChild(n)}))}()}(window,document);