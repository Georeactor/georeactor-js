/*
 GeoReactor-Client 0.1.1+4419fdb  http://georeactor.com
 (c) 2016 Nicholas Doiron (under open source, MIT license)
*/
!function(o,t,e){"undefined"==typeof console&&(console={log:function(){},error:function(){}}),Array.prototype.forEach||(Array.prototype.forEach=function(o,t){var e,n;for(e=0,n=this.length;e<n;++e)e in this&&o.call(t,this[e],e,this)}),"map"in Array.prototype||(Array.prototype.map=function(o,t){for(var e=new Array(this.length),n=0,a=this.length;n<a;n++)n in this&&(e[n]=o.call(t,this[n],n,this));return e}),(o||global).georeactor=function(){console.error("GEOREACTOR: no maps library was added")},(o||global).GEOREACTOR={data:[],options:{},valuesForField:{},_:{}},function(){function o(o,n){var a=o,i=new XMLHttpRequest;i.open("GET",o,!0),i.onreadystatechange=function(){if(4===this.readyState)if(this.status>=200&&this.status<400){var o=null,i=a.toLowerCase();if(i.indexOf("topojson")>-1||i.indexOf("topo.json")>-1){var r=JSON.parse(this.responseText),s=Object.keys(r.objects)[0];o=topojson.feature(r,r.objects[s])}else{if(!(i.indexOf("geojson")>-1||i.indexOf("geo.json")>-1))throw"data type unknown: "+i;o=JSON.parse(this.responseText)}o.features.map(function(o){var n=Object.keys(o.properties);n.map(function(t){var e=o.properties[t];GEOREACTOR.valuesForField[t]||(GEOREACTOR.valuesForField[t]={min:e,max:e,nonZeroCount:0}),e<GEOREACTOR.valuesForField[t].min&&(GEOREACTOR.valuesForField[t].min=e),e>GEOREACTOR.valuesForField[t].max&&(GEOREACTOR.valuesForField[t].max=e),e&&GEOREACTOR.valuesForField[t].nonZeroCount++});var a=t(o.geometry.coordinates);o.properties.bounds=a,e?(e[0]=Math.min(e[0],a[0]),e[1]=Math.min(e[1],a[1]),e[2]=Math.max(e[2],a[2]),e[3]=Math.max(e[3],a[3])):e=a}),GEOREACTOR._.fitBounds(e),n(o)}else console.log("failed to do XMLHttpRequest")},i.send()}function t(o,e){if(e||(e=[180,90,-180,-90]),"number"==typeof o[0])e[0]=Math.min(e[0],o[0]),e[1]=Math.min(e[1],o[1]),e[2]=Math.max(e[2],o[0]),e[3]=Math.max(e[3],o[1]);else for(var n=0;n<o.length;n++)e=t(o[n],e);return e}var e;GEOREACTOR.commonDataLoader=function(){0===GEOREACTOR.options.data.length&&console.log("GEOREACTOR: no datasets to load"),GEOREACTOR.options.data.map(function(t){o(t,function(o){GEOREACTOR._.mapJSONfile(o)})})}}(),function(){var e,n;return"undefined"==typeof GEOREACTOR?void console.error("GEOREACTOR: georeactor-gmaps.js must be loaded for georeactor-gmaps to work"):(GEOREACTOR.library="gmaps",GEOREACTOR._.mapJSONfile=function(o){return e.data.addGeoJson(o),e.data.setStyle(function(o){return{fillColor:"#f00",fillOpacity:0,strokeColor:"#444",strokeWeight:1}}),e.data.addListener("click",function(o){if(GEOREACTOR._.fitBounds(o.feature.getProperty("bounds")),GEOREACTOR.selectFeature=o.feature,GEOREACTOR._.detailView&&GEOREACTOR._.detailView.setState({selectFeature:o.feature}),GEOREACTOR.options.popups){var t=["bounds"],a="<table>";o.feature.forEachProperty(function(o,e){t.indexOf(e)>-1||(a+="<tr><td>"+e+"</td><td>"+o+"</td></tr>")}),a+="</table>",n.setPosition(o.latLng),n.setContent(a),n.open(e)}e.data.setStyle(function(t){var e=0;return t===o.feature&&(e=.2),{fillColor:"#f00",fillOpacity:e,strokeColor:"#444",strokeWeight:1}})}),e.data},GEOREACTOR.initMap=function(){e=new google.maps.Map(t.getElementById(GEOREACTOR.options.div||"map"),{zoom:GEOREACTOR.options.zoom||5,center:{lat:GEOREACTOR.options.lat||0,lng:GEOREACTOR.options.lng||GEOREACTOR.options.lon||0},streetViewControl:!1}),n=new google.maps.InfoWindow({map:e}),n.close(),GEOREACTOR._.fitBounds=function(o){e.fitBounds(new google.maps.LatLngBounds(new google.maps.LatLng(o[1],o[0]),new google.maps.LatLng(o[3],o[2])))},GEOREACTOR.commonDataLoader(),"function"==typeof GEOREACTOR.initReact&&GEOREACTOR.initReact()},void(georeactor=function(e){"localhost"===o.location.hostname&&(e.API_KEY=""),GEOREACTOR.options=e;var n=t.createElement("script");n.src="//maps.googleapis.com/maps/api/js?callback=GEOREACTOR.initMap&key=AIzaSyDfcomdn4y5hE1UblikOcMjtzY_ilhSP-4",t.body.appendChild(n)}))}()}(window,document);