/*
 GeoReactor-Client 0.1.1+fb47c5d  http://georeactor.com
 (c) 2016 Nicholas Doiron (under open source, MIT license)
*/
!function(e,t,o){"undefined"==typeof console&&(console={log:function(){},error:function(){}}),Array.prototype.forEach||(Array.prototype.forEach=function(e,t){var o,a;for(o=0,a=this.length;o<a;++o)o in this&&e.call(t,this[o],o,this)}),"map"in Array.prototype||(Array.prototype.map=function(e,t){for(var o=new Array(this.length),a=0,n=this.length;a<n;a++)a in this&&(o[a]=e.call(t,this[a],a,this));return o}),(e||global).georeactor=function(){console.error("GEOREACTOR: no maps library was added")},(e||global).GEOREACTOR={data:[],options:{},valuesForField:{},_:{}},function(){function e(e,a){var n=e,r=new XMLHttpRequest;r.open("GET",e,!0),r.onreadystatechange=function(){if(4===this.readyState)if(this.status>=200&&this.status<400){var e=null,r=n.toLowerCase();if(r.indexOf("topojson")>-1||r.indexOf("topo.json")>-1){var i=JSON.parse(this.responseText),s=Object.keys(i.objects)[0];e=topojson.feature(i,i.objects[s])}else{if(!(r.indexOf("geojson")>-1||r.indexOf("geo.json")>-1))throw"data type unknown: "+r;e=JSON.parse(this.responseText)}e.features.map(function(e){var a=Object.keys(e.properties);a.map(function(t){var o=e.properties[t];GEOREACTOR.valuesForField[t]||(GEOREACTOR.valuesForField[t]={min:o,max:o,nonZeroCount:0}),o<GEOREACTOR.valuesForField[t].min&&(GEOREACTOR.valuesForField[t].min=o),o>GEOREACTOR.valuesForField[t].max&&(GEOREACTOR.valuesForField[t].max=o),o&&GEOREACTOR.valuesForField[t].nonZeroCount++});var n=t(e.geometry.coordinates);e.properties.bounds=n,o?(o[0]=Math.min(o[0],n[0]),o[1]=Math.min(o[1],n[1]),o[2]=Math.max(o[2],n[2]),o[3]=Math.max(o[3],n[3])):o=n}),GEOREACTOR._.fitBounds(o),a(e)}else console.log("failed to do XMLHttpRequest")},r.send()}function t(e,o){if(o||(o=[180,90,-180,-90]),"number"==typeof e[0])o[0]=Math.min(o[0],e[0]),o[1]=Math.min(o[1],e[1]),o[2]=Math.max(o[2],e[0]),o[3]=Math.max(o[3],e[1]);else for(var a=0;a<e.length;a++)o=t(e[a],o);return o}var o;GEOREACTOR.commonDataLoader=function(){0===GEOREACTOR.options.data.length&&console.log("GEOREACTOR: no datasets to load"),GEOREACTOR.options.data.map(function(t){e(t,function(e){GEOREACTOR._.mapJSONfile(e)})})}}(),function(){if("undefined"==typeof GEOREACTOR)return void console.error("GEOREACTOR: georeactor-client.js must be loaded for georeactor-leaflet to work");GEOREACTOR.library="leaflet";var e,o;GEOREACTOR._.mapJSONfile=function(t){return dataLayer=L.geoJson(t,{style:function(e){return{fillColor:"#f00",fillOpacity:0,color:"#444",weight:2}},onEachFeature:function(t,a){a.on("click",function(){if("function"==typeof GEOREACTOR.initReact&&GEOREACTOR.initReact(),o&&e.removeLayer(o),"Point"===t.geometry.type){var a=t.geometry.coordinates.concat([]);a.reverse(),o=L.circleMarker(a,{radius:80,strokeColor:"#f00",fillColor:"#f00"}).addTo(e)}GEOREACTOR._.fitBounds(t.properties.bounds),GEOREACTOR.selectFeature=t,GEOREACTOR._.detailView&&GEOREACTOR._.detailView.setState({selectFeature:t}),dataLayer.setStyle(function(e){var o=0;return t===e&&(o=.2),{fillColor:"#f00",fillOpacity:o,color:"#444",weight:1}})})}}).addTo(e),dataLayer},georeactor=function(o){if(GEOREACTOR.options=o,e=L.map(o.div||"map").setView([0,0],5),e.attributionControl.setPrefix(""),"function"==typeof L.Hash&&new L.Hash(e),GEOREACTOR.options.tiles&&GEOREACTOR.options.tiles.length)if("string"==typeof GEOREACTOR.options.tiles)L.tileLayer(GEOREACTOR.options.tiles,{maxZoom:17}).addTo(e);else{var a={};GEOREACTOR.options.tiles.forEach(function(t,o){t=L.tileLayer(t,{maxZoom:17}).addTo(e),a["ABCDEFGHIJKLMNOPQRSTUVWXYZ"[o]]=t}),L.control.layers(a,{}).addTo(e)}else{var n=L.tileLayer("//tile-{s}.openstreetmap.fr/hot/{z}/{x}/{y}.png",{attribution:"Map data &copy; OpenStreetMap contributors",maxZoom:17}).addTo(e),r=L.tileLayer("//{s}.tiles.mapbox.com/v3/mapmeld.map-a6ineq7y/{z}/{x}/{y}.png?updated=65f7243",{attribution:"Map data &copy; OpenStreetMap contributors; satellite from MapBox",maxZoom:17});L.control.layers({OpenStreetMap:n,Satellite:r},{}).addTo(e),e.on("baselayerchange",function(){})}var i=t.getElementsByClassName("leaflet-control-layers-toggle");i.length&&setTimeout(function(){i[0].style.backgroundImage="url(styles/lib/images/layers.png)"},200),GEOREACTOR._.fitBounds=function(t){e.fitBounds(L.latLngBounds(L.latLng(t[1],t[0]),L.latLng(t[3],t[2])))},GEOREACTOR.commonDataLoader(),"function"==typeof GEOREACTOR.initReact&&GEOREACTOR.initReact()}}()}(window,document);