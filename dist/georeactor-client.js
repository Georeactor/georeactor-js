/*
 GeoReactor-Client 0.1.1+5aac031  http://georeactor.com
 (c) 2016 Nicholas Doiron (under open source, MIT license)
*/
!function(t,e,o){"undefined"==typeof console&&(console={log:function(){},error:function(){}}),Array.prototype.forEach||(Array.prototype.forEach=function(t,e){var o,a;for(o=0,a=this.length;o<a;++o)o in this&&t.call(e,this[o],o,this)}),"map"in Array.prototype||(Array.prototype.map=function(t,e){for(var o=new Array(this.length),a=0,n=this.length;a<n;a++)a in this&&(o[a]=t.call(e,this[a],a,this));return o});var a=function(){console.error("GEOREACTOR: no maps library was added")},n={data:[],options:{},valuesForField:{},_:{}};!function(){function t(t,a){var i=t,r=new XMLHttpRequest;r.open("GET",t,!0),r.onreadystatechange=function(){if(4===this.readyState)if(this.status>=200&&this.status<400){var t=null,r=i.toLowerCase();if(r.indexOf("topojson")>-1||r.indexOf("topo.json")>-1){var s=JSON.parse(this.responseText),l=Object.keys(s.objects)[0];t=topojson.feature(s,s.objects[l])}else{if(!(r.indexOf("geojson")>-1||r.indexOf("geo.json")>-1))throw"data type unknown: "+r;t=JSON.parse(this.responseText)}t.features.map(function(t){var a=Object.keys(t.properties);a.map(function(e){var o=t.properties[e];n.valuesForField[e]||(n.valuesForField[e]={min:o,max:o,nonZeroCount:0}),o<n.valuesForField[e].min&&(n.valuesForField[e].min=o),o>n.valuesForField[e].max&&(n.valuesForField[e].max=o),o&&n.valuesForField[e].nonZeroCount++});var i=e(t.geometry.coordinates);t.properties.bounds=i,o?(o[0]=Math.min(o[0],i[0]),o[1]=Math.min(o[1],i[1]),o[2]=Math.max(o[2],i[2]),o[3]=Math.max(o[3],i[3])):o=i}),n._.fitBounds(o),a(t)}else console.log("failed to do XMLHttpRequest")},r.send()}function e(t,o){if(o||(o=[180,90,-180,-90]),"number"==typeof t[0])o[0]=Math.min(o[0],t[0]),o[1]=Math.min(o[1],t[1]),o[2]=Math.max(o[2],t[0]),o[3]=Math.max(o[3],t[1]);else for(var a=0;a<t.length;a++)o=e(t[a],o);return o}var o;n.commonDataLoader=function(){0===n.options.data.length&&console.log("GEOREACTOR: no datasets to load"),n.options.data.map(function(e){t(e,function(t){n._.mapJSONfile(t)})})}}(),function(){if("undefined"==typeof n)return void console.error("GEOREACTOR: georeactor-client.js must be loaded for georeactor-leaflet to work");n.library="leaflet";var t,o;n._.mapJSONfile=function(e){return dataLayer=L.geoJson(e,{style:function(t){return{fillColor:"#f00",fillOpacity:0,color:"#444",weight:2}},onEachFeature:function(e,a){a.on("click",function(){if("function"==typeof n.initReact&&n.initReact(),o&&t.removeLayer(o),"Point"===e.geometry.type){var a=e.geometry.coordinates.concat([]);a.reverse(),o=L.circleMarker(a,{radius:80,strokeColor:"#f00",fillColor:"#f00"}).addTo(t)}n._.fitBounds(e.properties.bounds),n._.detailView.setState({selectFeature:e}),dataLayer.setStyle(function(t){var o=0;return e===t&&(o=.2),{fillColor:"#f00",fillOpacity:o,color:"#444",weight:1}})})}}).addTo(t),dataLayer},a=function(o){if(n.options=o,t=L.map(o.div||"map").setView([0,0],5),t.attributionControl.setPrefix(""),"function"==typeof L.Hash&&new L.Hash(t),n.options.tiles&&n.options.tiles.length)if("string"==typeof n.options.tiles)L.tileLayer(n.options.tiles,{maxZoom:17}).addTo(t);else{var a={};n.options.tiles.forEach(function(e,o){e=L.tileLayer(e,{maxZoom:17}).addTo(t),a["ABCDEFGHIJKLMNOPQRSTUVWXYZ"[o]]=e}),L.control.layers(a,{}).addTo(t)}else{var i=L.tileLayer("//tile-{s}.openstreetmap.fr/hot/{z}/{x}/{y}.png",{attribution:"Map data &copy; OpenStreetMap contributors",maxZoom:17}).addTo(t),r=L.tileLayer("//{s}.tiles.mapbox.com/v3/mapmeld.map-a6ineq7y/{z}/{x}/{y}.png?updated=65f7243",{attribution:"Map data &copy; OpenStreetMap contributors; satellite from MapBox",maxZoom:17});L.control.layers({OpenStreetMap:i,Satellite:r},{}).addTo(t),t.on("baselayerchange",function(){})}var s=e.getElementsByClassName("leaflet-control-layers-toggle");s.length&&setTimeout(function(){s[0].style.backgroundImage="url(styles/lib/images/layers.png)"},200),n._.fitBounds=function(e){t.fitBounds(L.latLngBounds(L.latLng(e[1],e[0]),L.latLng(e[3],e[2])))},n.commonDataLoader(),"function"==typeof n.initReact&&n.initReact()}}()}(window,document);